stages:
- build
- deploy

variables:
  BELUGA_IMAGES: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG
  COMPOSE_FILE: samples/gitlab/docker-compose.yaml

beluga:build:
  stage: build
  image: duckbrain/beluga
  script:
  - beluga env
  - beluga build

beluga:deploy:
  stage: deploy
  image: $BELUGA_IMAGES
  script:
  - beluga deploy
  - beluga env BELGUA_DOMAIN BELUGA_ENVIRONMENT > dotenv
  environment:
    name: $BELUGA_ENVIRONMENT
    url: https://$BELUGA_DOMAIN
  artifacts:
    reports:
      dotenv: dotenv
